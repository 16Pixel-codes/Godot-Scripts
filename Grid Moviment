extends CharacterBody2D

@export var tile_size: int = 16
@export var speed: float = 200

@onready var destination: Vector2 = position

func _physics_process(delta):
	
	input_control()
	move()

func input_control():
	if position != destination: return
	
	var new_direction = Vector2.ZERO
	
	if Input.is_action_pressed("ui_right") and !$right.is_colliding(): new_direction = Vector2.RIGHT
	elif Input.is_action_pressed("ui_left") and !$left.is_colliding(): new_direction = Vector2.LEFT
	elif Input.is_action_pressed("ui_up") and !$up.is_colliding(): new_direction = Vector2.UP
	elif Input.is_action_pressed("ui_down") and !$down.is_colliding(): new_direction = Vector2.DOWN
	
	if new_direction != Vector2.ZERO:
		destination = position + new_direction * tile_size

func move():
	if position == destination: return
	
	velocity = (destination - position).normalized() * speed
	move_and_slide()
	
	if position.distance_to(destination) < 1:
		
		velocity = Vector2.ZERO
		position = destination
